<!doctype html>
<html lang="en">
    <head>
        <title>zavr blog</title>
        <link href="styles/app.css" rel="stylesheet">
        <link href="styles/default.css" rel="stylesheet">
        <link href="styles/prism.css" rel="stylesheet">
        <link href="img/favicon.png" rel="shortcut icon">
        <link href="https://fonts.googleapis.com/css?family=Ruda" rel="stylesheet">
      <link href="loaders/inner-circles.css" rel="stylesheet">
    </head>
    <body>
        <span class="inner-circles-loader" style="display:none;" id="SplendidLoader">Loading...</span>
        <div class="table">
        <div class="left-column">
            <img src="img/zavr.jpg" alt="Zavr"/>
            <ul class="AjaxNav">
                <li class="Active">
                    <a data-file="index" href="/">zavr blog</a>
                  </li>
              </ul>
        </div>
        <div class="right-column" id="Content">
            <h1>Zavr.co.uk 2019</h1>
            
            This is a javascript.dev blog.
            
            
            <h2>7 February</h2>
            
            Today I've started to fill up the <strong>depack</strong> scope with packages on NPM by transferring existing work into it. The first two packages are <span class="tm">@depack/router</span> and <span class="tm">@depack/form</span> that were taken from the <span class="tm">knedv.ru</span> website. The router is the adaptation of the <span class="tm">preact-router</span> that was modified to work with <em>Depack</em>. The reason it wasn't working was because some properties were assigned on string nodes which threw an error, and also because <span class="tm2">__preactattr_</span> was referenced without using quotes and got mangled by the Closure Compiler.
            
            <pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Original</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'preact'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'preact-router'</span>

<span class="token keyword">const</span> <span class="token function-variable function">Component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> title <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Router<span class="token operator">></span>
  <span class="token operator">&lt;</span>Component path<span class="token operator">=</span><span class="token string">"/"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
</code></pre>
            
            <pre><code class="js hljs"><span class="hljs-comment">// Transpiled into</span>
<span class="hljs-comment">// ...</span>
                <span class="hljs-comment">// â†“ the string that results in error</span>
render(h(Router,{},<span class="hljs-string">`
  `</span>,h(Component,{<span class="hljs-attr">path</span>:<span class="hljs-string">"/"</span>}),<span class="hljs-string">`
`</span>), <span class="hljs-built_in">document</span>.body)</code></pre>
            
            <img src="img/2019/2-feb/error.jpg" alt="Error in preact-router">
            
            <p>
            I also made the demo preview of the <span class="tm">@depack/router</span> using <em>Splendid</em> and had to update <em>Splendid</em> to insert files manually with the <span class="tm">&lt;File&gt;</span> tag for the purpose of adding the source map to the website JavaScript bundle made with <em>Depack</em>. It will also now show an error if a page does not exist, and produce better JSX code highlighting with Prism, since highlightjs does not work with JSX.
            </p>
            
            <p class="Figure">
                <img src="img/2019/2-feb/appshot-Safari.gif" alt="Demo for @depack/router" /><br />
                
              View the demo at <a href="https://dpck.github.io/router/">https://dpck.github.io/router/</a>
            
              </p>
            
            <p>
            In addition, I integrated the <span class="tm">@idio/frontend</span> package into the <em>Idio Core</em> web server where it is possible to mount multiple frontend directories at once. There is an additional check to see if the pointed directory exists when starting the server. To sum up, the achievements of the day were moving most of the existing code into new packages, and integrating them into other tools (e.g., taking the router code out of <span class="tm">knedv.ru</span> website, putting it in a separate package and then installing that package into <span class="tm">knedv.ru</span> again). It is not always feasible to start making new packages straight away because when they need to be updated, the routine is more complicated when compared to the situation where the code is kept in the same package, but when the code has been somewhat manually tested, it can be made into separate software.
            </p>
            
            <p>Finally, in the spirit of starting to breath life into existing scopes and domains rather than creating new ones, I decided to use my existing <span class="tm">zavr.co.uk</span> domain to blog about work to keep track of the things that I've done. I had already done so on the <a href="https://github.com/artdecocode/daily-log">daily-log</a> which was a GitHub blog compiled with <em>Documentary</em>, however I thought it would be a good use-case for <em>Splendid</em> to compile a blog website, so that new features could emerge.
            </p>
            
            <p>
            Unfortunately, the <span class="tm">depack</span> GitHub organisation was taken since summer which is a bummer because it's when I first thought of <em>Depack</em> and I think I could have registered the org back then. The person has only registered to open a single issue, but nevermind I got the <span class="tm">dpck</span> org which is also acceptable and is cool in a way. It will specialise on publishing packages that can be safely compiled with <em>Depack</em> for front-end, since a lot of existing widgets and libraries will most likely require some adjustments to do that. The next package in the queue is <span class="tm">@depack/from</span> which is a bootstrap form that was quickly written by me earlier last week. It needs a better model where the root <span class="tm">Form</span> component would hold the values of all fields to be able to handle which components need re-rendering better. There are also tests to be written for front-end which is a new important chapter in <strong>Art Deco</strong> software development: <em>Zoroaster</em> will need to be modified to have a persistent context (to keep the browser open between tests), and strategies for communicating with browsers to run test suites will also need to be derived, since we're not going to use <em>Karma</em> and its adapters.
            </p>
            
            <h3>ToDo</h3>
            <ul>
             <li>Setup the front-end testing infrastructure by allowing <em>Zoroaster</em> tests to have persistent context.</li>
             <li>Update the structure in <em>Splendid</em> to have components directory with the new AjaxMenu, don't override package.json if it exists, rework example pages.</li>
             <li>Come up with a web-interface where dependencies can be updated quickly, e.g., if I update <span class="tm">@a-la/jsx</span>, then <span class="tm">@idio/frontend</span> needs to be updated so that <span class="tm">@idio/core</span> can access the new feature or bugfix in the JSX. This is a requirement for <em>Moderne</em>, however can be implemented in MNPJS.org as well.</li>
            </ul>
            
        </div>
        </div>
        <footer>
            &copy; <a href="https://zavr.co.uk">Zavr</a>, 2019
        </footer>
        <script src="js/main.js"></script>
      <script src="js/ajax-loader.js"></script>
      <script>window.AjaxLoader()</script>
    </body>
</html>
