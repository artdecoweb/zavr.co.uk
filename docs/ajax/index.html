{"title":"zavr blog","content":"<h2>11-17 February</h2>\n\nThe job for this week is to finish work on <em>Depack</em>, document the frontend bundler part of it, and add the possibility to override Node.js builtin externs. The message about it can then be spread on the Google Closure Compiler group and Medium. After that, <em>Zoroaster</em> can be modified to have persistent contexts and test frontend Preact packages that I have and will make (<span class=\"tm2\">router</span> and <span class=\"tm2\">form</span>). On the 15<sup>th</sup>, the call for papers for <a href=\"https://jscamp.tech/\">JSCamp in Barcelona</a> opens, so I will apply to that with the story about <em>Depack</em> and <em>Frontend</em>, which could hopefully be useful to others.\n\n<p class=\"SectionBreak\">\n  <a href=\"#top\" title=\"Back To Top\">\n    <img src=\"section-breaks/-3.svg\" alt=\"Back To Top\">\n  </a>\n</p>\n\n<h2>11 Monday</h2>\n\n<p>\n\nOn Monday, I worked on filling in the <span class=\"tm\">static-analysis</span> package with the code from <em>Depack</em>, so that when I took it out of <em>Depack</em>, the latter looked much neater because it focused on packing the code together rather than performing the static analysis tasks. I also documented the new package so that I can visually see what it generates by automatically embedding examples. This new package was also needed for the <strong>bundle</strong> part of <em>Depack</em> to discover dependencies in node_modules\n. The task was complete successfully and I was able to integrate <span class=\"tm2\">@depack/bundle</span> into <em>Depack</em> and compile the <span class=\"tm\">knedv.ru</span> Preact website. Additionally, I released the change to <em>Ã€LaMode</em> that was required to build JSX modules to prepare them for <em>Depack</em> bundling, since it was decided that external modules would have to provide already compiled JSX code to simplify the process.\n</p>\n\n<p>\n\nI then worked more on documentation of the <em>Form</em> package for <em>Depack</em> and included the types notations as well as examples. I found the way to provide <em>JSDoc</em> IntelliSense suggestions for the VSCode for components written as classes, which I struggled with before. It's a workaround that requires an extra meaningless line to the code, but it is worth the result that it produces. For example, to document the <span class=\"tm2\">FormGroup</span> component, I would have to add the <span class=\"tm\">this.props = this.props</span> assignment annotated with the type:\n\n</p>\n\n<pre><code class=\"js hljs\"><span class=\"hljs-comment\">/**\n * The div with `form-group` class to hold the label, input, help and validation message.\n */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">FormGroup</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Component</span> </span>{\n  <span class=\"hljs-keyword\">constructor</span>() {\n    <span class=\"hljs-keyword\">super</span>()\n    <span class=\"hljs-keyword\">this</span>.id = <span class=\"hljs-string\">`i<span class=\"hljs-subst\">${<span class=\"hljs-built_in\">Math</span>.floor(<span class=\"hljs-built_in\">Math</span>.random() * <span class=\"hljs-number\">100000</span>)}</span>`</span>\n    <span class=\"hljs-keyword\">this</span>.hid = <span class=\"hljs-string\">`h<span class=\"hljs-subst\">${<span class=\"hljs-keyword\">this</span>.id}</span>`</span>\n    <span class=\"hljs-comment\">/**\n     * @type {FormGroupProps}\n     */</span>\n    <span class=\"hljs-keyword\">this</span>.props = <span class=\"hljs-keyword\">this</span>.props\n  }\n  <span class=\"hljs-comment\">/* ... methods */</span>\n}</code></pre>\n\n<p class=\"Figure\">\n    <img src=\"img/2019/2-feb/ap.gif\" alt=\"JSX in VSCode For JSX Components Classes\" /><br />\n    \n  </p>\n\n<p>\nThe props can then also be used in the documentation by simply calling <span class=\"tm\">%TYPEDEF types/index.xml FormGroupProps%</span> which <em>Documentary</em> understands. This help to discover the bug which I then fixed in <em>Documentary</em> when types tables referenced by name after the first one were not inserted.\n</p>\n\n<p class=\"Figure\">\n    <img src=\"img/2019/2-feb/doc.png\" alt=\"GitHub Documentation\" /><br />\n    \nView <em>Form</em> documentation at <a href=\"https://github.com/dpck/form\">https://github.com/dpck/form</a>\n  \n  </p>\n\n<p>\nTowards the end of the day, I spent some time on writing an HTML formatter, because after I removed passing new lines as strings to the JSX pragma (see previous week), the <span class=\"tm\">preact-render-to-string</span> package started to render the code without indentations which was hard to read and not suitable for the documentation. Therefore, I made a simple at-first function that split tags at <span class=\"tm\">&gt;&lt;</span> point and inserted new lines between them. It was then modified to account for opening and closing tags, as well as if the tag is a textarea element which means there cannot be any new lines. I then had a neat function which also indented attributes after the line width became too large, and presented all example HTML output of the <em>Form</em> component in a nice way:\n</p>\n\n<pre><code class=\"html hljs\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-group\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">label</span> <span class=\"hljs-attr\">htmlFor</span>=<span class=\"hljs-string\">\"i90435\"</span>&gt;</span>\n      Input\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">label</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"input\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-control\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"hello-world\"</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text\"</span>\n      <span class=\"hljs-attr\">aria-describedby</span>=<span class=\"hljs-string\">\"hi90435\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"i90435\"</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">small</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"hi90435\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-text text-muted\"</span>&gt;</span>\n      Type in something...\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">small</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-group\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">label</span> <span class=\"hljs-attr\">htmlFor</span>=<span class=\"hljs-string\">\"i12194\"</span>&gt;</span>\n      Select\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">label</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"select\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"2\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"custom-select\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"i12194\"</span>\n      <span class=\"hljs-attr\">aria-describedby</span>=<span class=\"hljs-string\">\"hi12194\"</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">option</span>&gt;</span>\n\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">option</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">option</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"1\"</span>&gt;</span>\n        Free will\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">option</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">option</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">\"2\"</span> <span class=\"hljs-attr\">selected</span>=<span class=\"hljs-string\">\"true\"</span>&gt;</span>\n        Unfree will\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">option</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">small</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"hi12194\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-text text-muted\"</span>&gt;</span>\n      Please select...\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">small</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-group\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">label</span> <span class=\"hljs-attr\">htmlFor</span>=<span class=\"hljs-string\">\"i51376\"</span>&gt;</span>\n      TextArea\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">label</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">textarea</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"textarea\"</span> <span class=\"hljs-attr\">aria-describedby</span>=<span class=\"hljs-string\">\"hi51376\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-control\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"i51376\"</span> <span class=\"hljs-attr\">rows</span>=<span class=\"hljs-string\">\"3\"</span>&gt;</span>One must still have chaos in oneself to be able to give birth to a dancing star.<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">textarea</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">small</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"hi51376\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form-text text-muted\"</span>&gt;</span>\n      Multiple row input...\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">small</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">form</span>&gt;</span></code></pre>\n\n<h3>TODO</h3>\n<ul>\n<li>Make the html formatter a separate package.</li>\n<li>Unit test rendering of components with <span class=\"tm\">preact-render-to-string</span> first before writing acceptance tests for the browser. <span class=\"tm\">rexml</span> package can be used here, however it would not be able to extract multiple elements of the same kind in a parent.</li>\n<li>Add an article on Medium about how to add JSDoc for Preact class components without using TypeScript.</li>\n</ul>\n\n<p class=\"SectionBreak\">\n  <a href=\"#top\" title=\"Back To Top\">\n    <img src=\"section-breaks/0.svg\" alt=\"Back To Top\">\n  </a>\n</p>","file":"11-17-february"}