<!doctype html>
<html lang="en">
    <head>
        <title>11-17 February 2019</title>
        <link href="styles/app.css" rel="stylesheet">
        <link href="styles/default.css" rel="stylesheet">
        <link href="styles/prism.css" rel="stylesheet">
        <link href="img/favicon.png" rel="shortcut icon">
        <link href="https://fonts.googleapis.com/css?family=Ruda" rel="stylesheet">
      <link href="loaders/inner-circles.css" rel="stylesheet">
    </head>
    <body>
        <span class="inner-circles-loader" style="display:none;" id="SplendidLoader">Loading...</span>
        <div class="table">
        <div class="left-column">
            <img src="img/zavr.jpg" alt="Zavr"/>
            <h1>Zavr.co.uk 2019</h1>

            <p>This is a javascript.dev blog.</p>
            <ul class="AjaxNav"><li class><a data-file="18-24-february" href="/">zavr blog</a></li><li class="Active"><a data-file="11-17-february" href="11-17-february.html">11-17 February 2019</a></li><li class><a data-file="4-10-february" href="4-10-february.html">4-10 February 2019</a></li></ul>
        </div>
        <div class="right-column" id="Content">
            <h2>11-17 February</h2>
            
            The job for this week is to finish work on <em>Depack</em>, document the frontend bundler part of it, and add the possibility to override Node.js builtin externs. The message about it can then be spread on the Google Closure Compiler group and Medium. After that, <em>Zoroaster</em> can be modified to have persistent contexts and test frontend Preact packages that I have and will make (<span class="tm2">router</span> and <span class="tm2">form</span>). On the 15<sup>th</sup>, the call for papers for <a href="https://jscamp.tech/">JSCamp in Barcelona</a> opens, so I will apply to that with the story about <em>Depack</em> and <em>Frontend</em>, which could hopefully be useful to others.
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/-3.svg" alt="Back To Top" /></a></p>
            
            <h2>Week Results</h2>
            
            <p>This week was slower than the previous one and more relaxed with more freestyle creative work rather than concrete focus.</p>
            
            <img src="img/2019/2-feb/2-17.jpg" style="padding: 0.5rem 0;">
            
            <p>The things accomplished were:</P>
            
            <ul>
            <li>Create the website for <em>Depack/Form</em>;</li>
            <li>Update <em>Splendid</em> to allow for mounted websites and switching to using JSX components;</li>
            <li>Documenting <em>Depack/Form</em> with pretty html;</li>
            <li>Finding the way to enable JSDoc properties autocompletion for Class components;</li>
            <li>Improving <em>Zoroaster</em> to pass mask properties to mask constructors;</li>
            <li>Releasing <a href="https://npmjs.com/package/logarithm" class="Badge"><span class="name"><em>Logarithm</em></span><span class="version">1.0.0</span></a> built with <em>Depack</em>;</li>
            <li>Creating the <em>Depack/Render</em> and improving Preact's algorithm for pretty print;</li>
            <li>Fixing the bugs in <em>ÀLa/JSX</em> related to boolean attributes;</li>
            <li>Adding <em>Depack/Context</em> for mask-testing of front-end JSX components;</li>
            <li>Registering the <span class="tm">@reducer</span> NPM scope (with <span class="tm2">rdcr</span> GitHub org) and creating the <span class="tm">render-reducer</span> package which in future will make sure that the element is always rendered whenever its parent is present.</li>
            </ul>
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/-2.svg" alt="Back To Top" /></a></p>
            
            <h2>17 Sunday</h2>
            
            <p>On Sunday, I wanted to document using <em>Depack/Render</em> on a server for server-side-rendering, like the original <a href="https://github.com/developit/preact-render-to-string/#render-jsx--preact--whatever-via-express"><em>Preact</em> documentation</a> does for Express. I also added the <span class="tm">doctype</span> option that would automatically add <span class="tm2">&lt;!doctype html&gt;</span> at the beginning of the rendered string, and fixed a JSDoc bug due to incorrect typedef name in the config, that prevented developers from seeing the correct property expansion on the <span class="tm">Config</span> property, which was at some point renamed to be <span class="tm">RenderConfig</span>. The types directory also had to be published because the types were to be used in another package called <em>Depack/Context</em> used for testing of front-end components.</p>
            
            <p><em>Depack/Context</em>'s job is to take the JSX source code from the mask, transform it into HTML and compare the expected output of the mask. The two packages used for that are <em>ÀLa/JSX</em> to compile the source into <strong>h</strong> pragma invocations by Preact, and <em>Depack/Render</em> to render the invocations into actual HTML. The <em>Depack/Render</em> is also tested with the JSX context, but using the source <span class="tm">render</span> function rather the one provided by the context. The context and render packages had to be linked because they depend on each other, however after <em>Depack/Render</em> is released and used in <em>Depack/Context</em>, it does not need releasing even after the context version is increased since it's only a dev dependency, otherwise there would be an infinite race to increase versions of these two packages. Finally, I also tested the <em>Depack/Form</em> component with the context, which will now be the standard way to mask test components. The context is similar to the snapshot testing, however with the advantage of not having to write a test logic for each input.
            </p>
            
            <pre class="language-jsx"><code class="language-jsx"><span class="token comment">// returns the correct output</span>
<span class="token operator">&lt;</span>Form<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span>

<span class="token comment">/* expected */</span>
<span class="token operator">&lt;</span>form<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span class="token comment">/**/</span>

<span class="token comment">// creates FormGroup</span>
<span class="token operator">&lt;</span>FormGroup label<span class="token operator">=</span><span class="token string">"test"</span> help<span class="token operator">=</span><span class="token string">"ok"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Input placeholder<span class="token operator">=</span><span class="token string">"test"</span><span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>FormGroup<span class="token operator">></span>

<span class="token comment">/* expected */</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">"i70984"</span><span class="token operator">></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
  <span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">"test"</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"form-control"</span> type<span class="token operator">=</span><span class="token string">"text"</span>
    aria<span class="token operator">-</span>describedby<span class="token operator">=</span><span class="token string">"hi70984"</span> id<span class="token operator">=</span><span class="token string">"i70984"</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>small id<span class="token operator">=</span><span class="token string">"hi70984"</span>
    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"form-text text-muted"</span><span class="token operator">></span>ok
  <span class="token operator">&lt;</span><span class="token operator">/</span>small<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token comment">/**/</span></code></pre>
            
            Lastly, one interesting feature is passing the references to the components used in masks' JSX input, which enables testing of the built components with the <span class="tm">test-build</span> command.
            
            <pre><code class="js hljs"><span class="hljs-keyword">import</span> Form, { FormGroup, Input } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src'</span>
<span class="hljs-comment">// during the `test-build`:            '../../build'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> makeTestSuite(<span class="hljs-string">'test/result/index.jsx'</span>, {
  <span class="hljs-comment">/**
   * @param {string} input
   * @param {JSXContext} context
   */</span>
  getResults(input, { getVNode, render }) {
    <span class="hljs-keyword">const</span> vnode = getVNode(input, {
      Form, FormGroup, Input, <span class="hljs-comment">// PASS THE SOURCE COMPONENTS</span>
    })
    <span class="hljs-keyword">const</span> res = render(vnode, {
      <span class="hljs-attr">pretty</span>: <span class="hljs-literal">true</span>,
    })
    <span class="hljs-keyword">return</span> res
  },
}</code></pre>
            
            The good thing about test contexts, as always, is that they provide accessible <strong>JSDoc</strong> documentation for the testing API that they provide.
            
            <img src="img/2019/2-feb/appshot-Code-form.gif" style="padding: 1rem 0;">
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/0.svg" alt="Back To Top" /></a></p>
            
            <h2>16 Saturday</h2>
            
            Saturday involved finishing off updating the <em>ContextTesting/Fork</em> logic to perform the mask testing where mask's properties would be passed to the fork config generator functions such as <span class="tm">getArgs</span> and <span class="tm">getOptions</span>. In addition, I added the appropriate documentation to the <span class="tm">fork</span> package with the example of how to use it. I then published it, integrated into <em>Zoroaster</em> so that the tests I wrote the previous day started to pass and used the newer version to test <em>ÀLaMode</em> which confirmed the fork context logic to work correctly.
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/1.svg" alt="Back To Top" /></a></p>
            
            <h2>15 Friday</h2>
            
            Friday was documenting <em>Depack/Render</em> to give examples of both standard and pretty rendering. The default line length was also reduced from 80 to 40 and documented easily with <em>Documentary</em> by updating the <span class="tm2">types/index.xml</span> file. There was also the task of updating the docs for <em>Depack/Form</em>, but because <a href="https://npmjs.com/package/alamode" class="Badge"><span class="name"><em>ÀLaMode</em></span><span class="version">1.8.1</span></a> was not updated to include bugfixes in <em>À-La/JSX</em> I had to release the new version that would render the boolean attributes used in forms correctly (e.g., <span class="tm">&lt;option selected&gt;</span> instead of <span class="tm">&lt;option selected=&quot;true&quot;&gt;</span>). However instead of just upping the versions of node_modules
            , I wanted to contribute to the Quality Assurance of the package and implemented a test for the require hook that transpiles JSX. Previously, there were no tests for such functionality and it was a slight challenge to understand how to test it. The method chosen to do that is via forks to make sure that the <span class="tm">require</span> function is "fresh" for every test &mdash; otherwise it's a function with side-effects such as caching, so there's a possibility that tests would produce an incorrect result. To mask test <span class="tm">require</span> via a fork, the input from the mask is taken and put in a temp JSX file using <em>TempContext</em>, which is then required by the tests. The input then also prints the function which is contained in it and which will be transpiled by the hook if everything goes right.
            
            <pre><code class="js hljs"><span class="hljs-comment">// The mask test setup.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> jsx = makeTestSuite(<span class="hljs-string">'test/result/jsx.js'</span>, {
  <span class="hljs-attr">fork</span>: {
    <span class="hljs-attr">module</span>: <span class="hljs-string">'test/fixture/require'</span>,
    <span class="hljs-comment">/**
     * @param {TempContext} t
     */</span>
    <span class="hljs-keyword">async</span> getOptions({ write }) {
      <span class="hljs-keyword">const</span> p = <span class="hljs-keyword">await</span> write(<span class="hljs-string">'temp.jsx'</span>, <span class="hljs-keyword">this</span>.input)
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">env</span>: {
          <span class="hljs-attr">MODULE_PATH</span>: resolve(p),
        },
      }
    },
  },
  <span class="hljs-attr">context</span>: TempContext,
  <span class="hljs-attr">jsonProps</span>: [<span class="hljs-string">'expected'</span>],
})</code></pre>
            
            <pre class="language-jsx"><code class="language-jsx"><span class="token comment">// The mask result: transpiles jsx with the require hood</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"test"</span><span class="token operator">></span>
      Hello World
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>App<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">/* stdout */</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>className<span class="token punctuation">:</span><span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`Hello World`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**/</span></code></pre>
            
            The idea for mask testing that I had was only possible with some changes to <em>Zoroaster</em>, because there was no way to access the <span class="tm">input</span> property from the fork config's <span class="tm">getOptions</span> method, and I planned previously to update the Mask API to access this and other properties, so I added the tests for <em>Zoroaster</em> which would start passing as soon as I updated <em>ContextTesting/Fork</em>.
            
            <h3>ToDo</h3>
            
            <div><input id="i7888" type="checkbox" /> <label for="i7888">Create the fork of <span class="tm">pirates</span> which assigns require hooks, but is transpiled with <em>Babel</em> so that it is not possible to use it with <em>Depack</em>.</label></div>
            <div><input id="i979" type="checkbox" /> <label for="i979">Compile <em>ÀLaMode</em> with <em>Depack</em>.</label></div>
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/2.svg" alt="Back To Top" /></a></p>
            
            <h2>14 Thursday</h2>
            
            First thing on Thursday was refactoring some components in <em>Splendid</em> into being JSX components, including the <span class="tm2">&lt;SectionBreak/&gt;</span>, <span class="tm2">&lt;File/&gt;</span> and <span class="tm2">&lt;PageTitle/&gt;</span>. The new architecture to use JSX is better than simple regular expressions, because it's more idiosyncratic and could eventually help to write components for dynamic front-end as well, such as embedding them with <em>Preact</em>. It's also easier to maintain and document, however there is still an issue that the autosuggestions for component properties do not appear in the pages source code, however this could only be overcome by making all pages JSX components which is opposite to the goal of <em>Splendid</em> that allows to write simple HTML and markdown but embed components. Nonetheless, the new components looks much better, compare:
            
            <pre><code class="js hljs"><span class="hljs-comment">// The old way</span>
<span class="hljs-keyword">import</span> rexml <span class="hljs-keyword">from</span> <span class="hljs-string">'rexml'</span>
<span class="hljs-keyword">const</span> breaksRule = {
  <span class="hljs-attr">re</span>: <span class="hljs-regexp">/( *)(&lt;SectionBreak.*?\/&gt;)/gm</span>,
  replacement(m, ws, SectionBreak) {
    <span class="hljs-keyword">const</span> [{
      <span class="hljs-attr">props</span>: { width, <span class="hljs-attr">id</span>: i = <span class="hljs-keyword">this</span>.breaksCount, alt = <span class="hljs-string">'Back To Top'</span>, href = <span class="hljs-string">'#top'</span> }
    }] = rexml(<span class="hljs-string">'SectionBreak'</span>, SectionBreak)
    <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">parseInt</span>(i || <span class="hljs-string">'0'</span>)
    <span class="hljs-keyword">const</span> w = width ? <span class="hljs-string">` width="<span class="hljs-subst">${width}</span>"`</span> : <span class="hljs-string">''</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-string">`&lt;p class="SectionBreak"&gt;
  &lt;a href="<span class="hljs-subst">${href}</span>" title="<span class="hljs-subst">${alt}</span>"&gt;
    &lt;img src="splendid://section-breaks/<span class="hljs-subst">${id}</span>.svg" alt="<span class="hljs-subst">${alt}</span>"<span class="hljs-subst">${w}</span>&gt;
  &lt;/a&gt;
&lt;/p&gt;`</span>
    <span class="hljs-keyword">this</span>.breaksCount = id + <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> res.replace(<span class="hljs-regexp">/^/gm</span>, ws)
  },
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> breaksRule</code></pre>
            
            <pre class="language-jsx"><code class="language-jsx"><span class="token comment">// The new way</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">SectionBreak</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  width<span class="token punctuation">,</span> alt <span class="token operator">=</span> <span class="token string">'Back To Top'</span><span class="token punctuation">,</span> href <span class="token operator">=</span> <span class="token string">'#top'</span><span class="token punctuation">,</span>
  splendid<span class="token punctuation">,</span> id<span class="token punctuation">:</span> i <span class="token operator">=</span> splendid<span class="token punctuation">.</span>breaksCount<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>i <span class="token operator">||</span> <span class="token string">'0'</span><span class="token punctuation">)</span>
  splendid<span class="token punctuation">.</span>breaksCount <span class="token operator">=</span> id <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">"SectionBreak"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span>href<span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token punctuation">{</span>alt<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token string">`splendid://section-breaks/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.svg`</span></span><span class="token punctuation">}</span>
        alt<span class="token operator">=</span><span class="token punctuation">{</span>alt<span class="token punctuation">}</span> width<span class="token operator">=</span><span class="token punctuation">{</span>width<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
            
            <p>JSX Components are also nicer to test and will help me to derive the infrastructure for testing frontend software. I choose the testing strategy that would involve rendering the components using <span class="tm">preact-render-to-string</span> as the initial unit tests. However, I was not happy with the fact that this package is dependent on the <strong>pretty-format</strong> package which belongs to Facebook and also pulls the <span class="tm">strip-ansi</span> package downloads counter of which I don't want to increase (I don't like popular packages). Therefore, I forked it and made a new package for rendering server-side HTML called <em>Depack/Render</em>. The main advantage of doing that is that I understood more how server-side rendering is done in <em>Preact</em>, and made some modifications myself. In particular, I improved the <strong>pretty printing</strong> functionality which in original <em>Preact/Render</em> would put each new attribute on the new line which is not feasible for documentation. Earlier this week, I wrote a simple script to format HTML, however it was error-prone and approached the problem from outside of the black "rendering" box, whereas modifying the actual rendering logic is getting inside of that box and having more control of what's happening. This made the previous script for formatting HTML redundant, however I was then able to compile <em>Depack/Form</em> documentation with <em>Depack/Render</em> and it was nicely presented like I wanted it to.</p>
            
            <p>There were some bugs I found out about in the <a href="https://npmjs.com/package/@a-la/jsx" class="Badge"><span class="name"><em>À-La/JSX</em></span><span class="version">1.4.0</span></a> such as that boolean attributes were assigned the value of <strong>1</strong> rather than an empty value, which <em>Preact</em> rendering was expecting, e.g., the <span class="tm">&lt;input required&gt;</span> would be incorrectly rendered as <span class="tm">&lt;input required=&quot;1&quot;&gt;</span>. And exactly because I forked <em>Preact/Render</em> and studied the source code while modifying it for my <em>Depack/Render</em> fork I was able to identify this problem. The second bug was discovered when writing unit-tests and involved JSX package only processing a single boolean attribute where there could be any number of them. The problem was solved with a single <span class="tm">g</span> modifier to the RegExp.</p>
            
            <a href="https://github.com/a-la/jsx/commit/d76d56b5f318a14523053fb3a7afe9ef081c55ba"><img src="img/2019/2-feb/git.jpg" /></a>
            
            <h3>ToDo</h3>
            
            <div><input id="i2708" type="checkbox" /> <label for="i2708">When counting the line length in <em>Depack/Render</em>, the whitespace before the line should also be considered.</label></div>
            <div><input id="i6703" type="checkbox" /> <label for="i6703">Load CSS from components' source code into the page source.</label></div>
            <div><input id="i735" type="checkbox" /> <label for="i735">Write documentation for <em>Splendid</em> components.</label></div>
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/3.svg" alt="Back To Top" /></a></p>
            
            <h2>13 Wednesday</h2>
            
            <p>On Wednesday, I started by adding two badges to the website, the <span class="tm">NPMBadge</span> and <span class="tm">GitHub</span> badge, which were implemented as components. There was also a <span class="tm">SelfBadge</span> which would read information from the <span class="tm">package.json</span> of the package for which the website is made with <em>Splendid</em> and display the correct information there. The components are also made to be <strong>async</strong> now so that they can execute some asynchronous operation before their rendering. This type of JSX components is only made for <em>Splendid</em> and cannot be used in other JSX components.</p>
            
            <img src="img/2019/2-feb/version.png">
            
            <p>I then worked more on <em>Splendid</em> to enable correct AJAX behaviour when a page is mounted not on the root of the domain, e.g., <a href="https://dpck.github.io/form/">https://dpck.github.io/form/</a>. It required an update the the frontend <strong>ajax-loader.js</strong> script, which would receive the <span class="tm">root</span> property from the <em>Splendid</em> config, and load the page from there. Otherwise, webpages were attempted to always load from the root which GitHub pages does not allow. An update to the <em>Splendid</em> core was also required to tell the development server to serve files from the specified mount point. Another learning outcome is to compile AJAX library as the IIFE in isolation mode to prevent the overriding of scoped functions by other scripts. For example, the compiled AJAX code has the function named <span class="tm">x</span>, and the demo source code had the same function since they're both compiled with Google Closure Compiler, but because the latter was added at a later point, it would override the original <span class="tm">x</span> function and prevent AJAX navigation from working.</p>
            
            <p>Finally, I've finished documenting the <span class="tm">logarithm</span> software and published it on the NPM. The middleware allows to log each request's information into ElasticSearch. It was also compiled with <em>Depack</em> to ensure to install only dependencies for the API version of the package. I then enabled <em>Logarithm</em> on the <span class="tm2">knedv.ru</span> website, and I could see the visitors to the developments server (i.e., me) in the Kibana dashboard.</p>
            
            <p class="Figure"><img src="img/2019/2-feb/appshot-Chrome-kibana.gif" alt="Kibana Logs For Logarithm" /><br /><em>Logarithm</em> Middleware sends data about requests to the ElasticSearch. The portal is implemented as patched OSS <a href="https://github.com/dockspage/kibana-docker">Kibana with authentication</a>.</p>
            
            <h3>ToDo</h3>
            
            <div><input id="i8784" type="checkbox" /> <label for="i8784">Make an interactive component for <span class="tm">NPMBadge</span> that would show package information on hover (or do it with CSS).</label></div>
            <div><input id="i9668" type="checkbox" /> <label for="i9668">Update <em>Logarithm</em> to understand encoded characters.</label></div>
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/4.svg" alt="Back To Top" /></a></p>
            
            <h2>12 Tuesday</h2>
            
            <p>Today I worked on documentation of the <em>Depack/Form</em> package, and improved the formatting of HTML. The examples now also use the seeded random number generator that prevented updating of <span class="tm">id</span> values each time the documentation generator is run. I finished documenting every component and described writing custom components.
            <br>
            At night, during working on the website to close <a href="https://github.com/dpck/form/issues/1">#1</a>, I encountered the problem with the website generation where the demo would not re-render after AJAX navigation, because scripts dynamically added to the page via setting <span class="tm">innerHTML</span> on the container component do not execute. I went on to research the possible solutions and found the thread on <em>StackOverflow</em> describing how to solve the problem, by extracting the scripts using the regular expressions. <a href="https://github.com/artdecocode/splendid/blob/master/src/js/ajax-loader/index.js#L96">The change</a> had to be made to <em>Splendid</em> so that received scripts are executed. The adaptation to the original script was made to enable executing scripts with <span class="tm">module</span> type. The source maps for the <em>AJAX</em> library was also added to enable debugging, as well as source maps for the bundle Depack/Form compiled with <em>Depack</em>.</p>
            
            <pre><code class="js hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stripAndExecuteScript</span>(<span class="hljs-params">text</span>) </span>{
  <span class="hljs-keyword">var</span> scripts = <span class="hljs-string">''</span>
  <span class="hljs-keyword">var</span> modules = []
  <span class="hljs-keyword">var</span> cleaned = text.replace(<span class="hljs-regexp">/&lt;script([^&gt;]*)&gt;([\s\S]*?)&lt;\/script&gt;/gi</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">m, tags, script</span>)</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/type="module"/</span>.test(tags)) {
      modules.push(script)
      <span class="hljs-keyword">return</span>
    }
    scripts += script + <span class="hljs-string">'\n'</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
  })

  modules.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mod</span>) </span>{
    makeScript(mod, <span class="hljs-literal">true</span>)
  })

  makeScript(scripts)
}</code></pre>
            
            <img src="img/2019/2-feb/form.png" alt="Depack/Form Demo">
            
            <p>
            On the about page, the <em>Depack/Form</em> demo is loaded from the compiled bundle made with <em>Depack</em>, whereas The <span class="tm">Modules Demo</span> page on the website loads the source code via modules. It was made to show the possibility of executing the javascript source code via the native browser functionality in modern browsers. It helped to discover a use case of when one would need to collect all dependencies' source files into a single directory which can be served by a CDN for example.
            </p>
            
            <h2>ToDo</h2>
            
            <div><input id="i250" type="checkbox" /> <label for="i250">Make it possible to generate modules to put on the static HTML server such as GitHub pages with Depack without bundling them into a single file. This includes supplying imports like <span class="tm">preact</span> with the source code in a separate file, as well is updating relative paths. This is partly what generating the temp directory does already.</label></div>
            <div><input id="i1275" type="checkbox" /> <label for="i1275">Teach <em>Splendid</em> to extract <span class="tm">&lt;Scripts&gt;</span> components to make it work better with Ajax by updating the <span class="tm">ajax</span> version of generated pages to have the <span class="tm">scripts</span> field in addition to the page's in-container <span class="tm">source</span> and <span class="tm">title</span>.</label></div>
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/5.svg" alt="Back To Top" /></a></p>
            
            
            <h2>11 Monday</h2>
            
            <p>
            
            On Monday, I worked on filling in the <span class="tm">static-analysis</span> package with the code from <em>Depack</em>, so that when I took it out of <em>Depack</em>, the latter looked much neater because it focused on packing the code together rather than performing the static analysis tasks. I also documented the new package so that I can visually see what it generates by automatically embedding examples. This new package was also needed for the <strong>bundle</strong> part of <em>Depack</em> to discover dependencies in node_modules
            . The task was complete successfully and I was able to integrate <span class="tm2">@depack/bundle</span> into <em>Depack</em> and compile the <span class="tm">knedv.ru</span> Preact website. Additionally, I released the change to <em>ÀLaMode</em> that was required to build JSX modules to prepare them for <em>Depack</em> bundling, since it was decided that external modules would have to provide already compiled JSX code to simplify the process.
            </p>
            
            <p>
            
            I then worked more on documentation of the <em>Form</em> package for <em>Depack</em> and included the types notations as well as examples. I found the way to provide <em>JSDoc</em> IntelliSense suggestions for the VSCode for components written as classes, which I struggled with before. It's a workaround that requires an extra meaningless line to the code, but it is worth the result that it produces. For example, to document the <span class="tm2">FormGroup</span> component, I would have to add the <span class="tm">this.props = this.props</span> assignment annotated with the type:
            
            </p>
            
            <pre><code class="js hljs"><span class="hljs-comment">/**
 * The div with `form-group` class to hold the label, input, help and validation message.
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FormGroup</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>()
    <span class="hljs-keyword">this</span>.id = <span class="hljs-string">`i<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">100000</span>)}</span>`</span>
    <span class="hljs-keyword">this</span>.hid = <span class="hljs-string">`h<span class="hljs-subst">${<span class="hljs-keyword">this</span>.id}</span>`</span>
    <span class="hljs-comment">/**
     * @type {FormGroupProps}
     */</span>
    <span class="hljs-keyword">this</span>.props = <span class="hljs-keyword">this</span>.props
  }
  <span class="hljs-comment">/* ... methods */</span>
}</code></pre>
            
            <p class="Figure"><img src="img/2019/2-feb/ap.gif" alt="JSX in VSCode For JSX Components Classes" /><br /></p>
            
            <p>
            The props can then also be used in the documentation by simply calling <span class="tm">%TYPEDEF types/index.xml FormGroupProps%</span> which <em>Documentary</em> understands. This help to discover the bug which I then fixed in <em>Documentary</em> when types tables referenced by name after the first one were not inserted.
            </p>
            
            <p class="Figure"><img src="img/2019/2-feb/doc.png" alt="GitHub Documentation" /><br />View <em>Form</em> documentation at <a href="https://github.com/dpck/form">https://github.com/dpck/form</a></p>
            
            <p>
            Towards the end of the day, I spent some time on writing an HTML formatter, because after I removed passing new lines as strings to the JSX pragma (see previous week), the <span class="tm">preact-render-to-string</span> package started to render the code without indentations which was hard to read and not suitable for the documentation. Therefore, I made a simple at-first function that split tags at <span class="tm">&gt;&lt;</span> point and inserted new lines between them. It was then modified to account for opening and closing tags, as well as if the tag is a textarea element which means there cannot be any new lines. I then had a neat function which also indented attributes after the line width became too large, and presented all example HTML output of the <em>Form</em> component in a nice way:
            </p>
            
            <pre><code class="html hljs"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"i90435"</span>&gt;</span>
      Input
    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"hello-world"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
      <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"hi90435"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"i90435"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hi90435"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text text-muted"</span>&gt;</span>
      Type in something...
    <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"i12194"</span>&gt;</span>
      Select
    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"select"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-select"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"i12194"</span>
      <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"hi12194"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span>&gt;</span>
        Free will
      <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">selected</span>=<span class="hljs-string">"true"</span>&gt;</span>
        Unfree will
      <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hi12194"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text text-muted"</span>&gt;</span>
      Please select...
    <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"i51376"</span>&gt;</span>
      TextArea
    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"textarea"</span> <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"hi51376"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"i51376"</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">"3"</span>&gt;</span>One must still have chaos in oneself to be able to give birth to a dancing star.<span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hi51376"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text text-muted"</span>&gt;</span>
      Multiple row input...
    <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre>
            
            <h3>TODO</h3>
            <ul>
            <li>Make the html formatter a separate package.</li>
            <li>Unit test rendering of components with <span class="tm">preact-render-to-string</span> first before writing acceptance tests for the browser. <span class="tm">rexml</span> package can be used here, however it would not be able to extract multiple elements of the same kind in a parent.</li>
            <li>Add an article on Medium about how to add JSDoc for Preact class components without using TypeScript.</li>
            </ul>
            
            <p class="SectionBreak"><a href="#top" title="Back To Top"><img src="section-breaks/6.svg" alt="Back To Top" /></a></p>
        </div>
        </div>
        <footer>
            &copy; <a href="https://zavr.co.uk">Zavr</a>, 2019
        </footer>
        <script src="js/main.js"></script>
      <script src="js/ajax-loader.js"></script>
      <script>window.AjaxLoader()</script>
    </body>
</html>
